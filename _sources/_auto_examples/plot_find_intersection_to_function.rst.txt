
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_auto_examples/plot_find_intersection_to_function.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download__auto_examples_plot_find_intersection_to_function.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__auto_examples_plot_find_intersection_to_function.py:


Find Drillhole intersection
=============================

This example demonstrates the basic usage of the DrillholeDatabase class
for a single drillhole and finding the intersection with a LoopStructural function
and visualising the model, drillhole and intersection point using Loop3DView/Pyvista

.. GENERATED FROM PYTHON SOURCE LINES 9-18

.. code-block:: Python


    import pandas as pd
    from loopresources import DrillholeDatabase
    import pyvista as pv
    import numpy as np
    from LoopStructural import GeologicalModel
    from LoopStructural.utils import strikedip2vector
    from LoopStructural.visualisation import Loop3DView








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Create our LoopStrutural Model
-----------------------------

.. GENERATED FROM PYTHON SOURCE LINES 21-36

.. code-block:: Python

    model = GeologicalModel([0, 0, 0], [10, 10, 10])
    data = pd.DataFrame(
        {
            "X": [1, 2, 3, 4, 5],
            "Y": [5, 5, 5, 5, 5],
            "Z": [10, 10, 10, 10, 10],
            "val": [0] * 5,
            "nx": [4.32978028e-17] * 5,
            "ny": [-7.07106781e-01] * 5,
            "nz": [7.07106781e-01] * 5,
            'feature_name': ['fault'] * 5,
        }
    )
    model.create_and_add_fault('fault', displacement=1.0, data=data)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    -----------------------------------------------------
    fault 9 
    -----------------------------------------------------
    	0 regions
    	0 faults.
    	Fault enabled True




.. GENERATED FROM PYTHON SOURCE LINES 37-39

Create Drillhole Data
-----------------------------

.. GENERATED FROM PYTHON SOURCE LINES 39-59

.. code-block:: Python

    collar = pd.DataFrame(
        {
            "HOLEID": ["DH1"],
            "EAST": [0],
            "NORTH": [0],
            "RL": [10],
            "DEPTH": [5],
        }
    )
    survey = pd.DataFrame(
        {
            "HOLEID": ["DH1", "DH1", "DH1"],
            "DEPTH": [0, 2, 5],
            "AZIMUTH": [0, 0, 0],
            "DIP": [-60, -62, -50],
        }
    )

    dhdb = DrillholeDatabase(survey=survey, collar=collar)








.. GENERATED FROM PYTHON SOURCE LINES 60-70

Find Intersection
-----------------------------
Find intersection of drillhole with geological model fault
LoopStructural uses a global and local coordinate system, we need to ensure that
the implicit functions are evaluated using the global coordinates.
To do this we can use the model.evaluate_feature_value(feature_name, coords) method
The `find_implicit_function_intersection` method of the DrillHole class can be used to find the intersection.
It requires a function that takes coords as an input and returns the implicit function value.
We can use a lambda function to wrap the model's method.


.. GENERATED FROM PYTHON SOURCE LINES 70-83

.. code-block:: Python


    pts = dhdb["DH1"].find_implicit_function_intersection(
        lambda xyz: model.evaluate_feature_value('fault', xyz)
    )
    print(f"\nIntersection points: \n {pts}")

    viewer = Loop3DView(model)
    viewer.plot_surface(model['fault'], 0.0)
    viewer.add_mesh(model.bounding_box.vtk().outline(), color='black')
    viewer.add_mesh(dhdb['DH1'].vtk())
    viewer.add_points(pts[['x', 'y', 'z']].values, color='blue', point_size=10)
    viewer.show()




.. image-sg:: /_auto_examples/images/sphx_glr_plot_find_intersection_to_function_001.png
   :alt: plot find intersection to function
   :srcset: /_auto_examples/images/sphx_glr_plot_find_intersection_to_function_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Intersection points: 
           DEPTH    x         y         z HOLEID
    0  2.938152  0.5  1.938551  6.938551    DH1




.. GENERATED FROM PYTHON SOURCE LINES 84-85

We can also calculate the orientation of the implicit function at the intersection points

.. GENERATED FROM PYTHON SOURCE LINES 85-87

.. code-block:: Python


    normals = model.evaluate_feature_gradient('fault', pts[['x', 'y', 'z']].values)
    print(f"\nIntersection normals: \n {normals}")



.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Intersection normals: 
     [[ 0.00189416 -0.13495161 -0.13495099]]





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 3.629 seconds)


.. _sphx_glr_download__auto_examples_plot_find_intersection_to_function.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_find_intersection_to_function.ipynb <plot_find_intersection_to_function.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_find_intersection_to_function.py <plot_find_intersection_to_function.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_find_intersection_to_function.zip <plot_find_intersection_to_function.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
